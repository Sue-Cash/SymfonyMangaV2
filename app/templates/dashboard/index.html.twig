{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
<div class="mb-4">
    <h1>Dashboard - Liste des Mangas</h1>
</div>

{# Formulaire de recherche et filtres #}
<form method="get" action="{{ path('app_dashboard') }}" class="row g-3 mb-4">
    <div class="col-md-3">
        <label for="filter_title" class="form-label">Titre</label>
        <input type="text" id="filter_title" name="title" value="{{ filter.title }}" class="form-control" placeholder="Rechercher par titre">
    </div>
    <div class="col-md-3">
        <label for="filter_price" class="form-label">Prix minimum</label>
        <input type="number" id="filter_price" name="price" value="{{ filter.price }}" step="0.01" class="form-control" placeholder="Prix minimum">
    </div>
    <div class="col-md-3">
        <label for="filter_author" class="form-label">Auteur (Email)</label>
        <input type="text" id="filter_author" name="author" value="{{ filter.author }}" class="form-control" placeholder="Rechercher par auteur">
    </div>
    <div class="col-md-2">
        <div class="form-check pt-4">
            <input class="form-check-input" type="checkbox" id="filter_onlyMine" name="onlyMine" {% if filter.onlyMine %}checked{% endif %}>
            <label class="form-check-label" for="filter_onlyMine">
                Mes mangas seulement
            </label>
        </div>
    </div>
    <div class="col-md-1 pt-4">
        <button type="submit" class="btn btn-primary">Filtrer</button>
    </div>
</form>

{# Bouton pour ajouter un nouveau manga #}
<div class="mb-3">
    <a href="{{ path('manga_new') }}" class="btn btn-success">Ajouter un Manga</a>
</div>

{# Tableau de listing des mangas #}
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Prix</th>
            <th>Date de création</th>
            <th>Auteur</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for manga in mangas %}
        <tr>
            <td>{{ manga.id }}</td>
            <td>{{ manga.title }}</td>
            <td>{{ manga.price }}</td>
            <td>{{ manga.createdAt ? manga.createdAt|date('d/m/Y H:i') : '' }}</td>
            <td>{{ manga.createdBy.email }}</td>
            <td>
                {% if is_granted('ROLE_ADMIN') or (manga.createdBy.id == app.user.id) %}
                    <a href="{{ path('manga_edit', {'id': manga.id}) }}" class="btn btn-sm btn-secondary">Edit</a>
                    {{ include('manga/_delete_form.html.twig', { 'manga': manga }) }}
                {% else %}
                    <span class="text-muted">Aucune action</span>
                {% endif %}
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="6">Aucun manga trouvé.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
